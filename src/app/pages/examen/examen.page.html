<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Examen</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">

  <!-- Cargando -->
  <div *ngIf="cargando" class="ion-text-center">
    <ion-spinner></ion-spinner>
    <p>Cargando preguntas...</p>
  </div>

  <!-- Examen activo -->
  <ion-card *ngIf="!terminado && preguntas.length > 0 && !cargando">
    <ion-card-header>
      <ion-card-title>
        Pregunta {{ preguntaActual + 1 }} de {{ preguntas.length }}
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <h2>{{ preguntas[preguntaActual].texto }}</h2>

      <ion-list>
        <ion-radio-group
          [value]="respuestasUsuario[preguntas[preguntaActual].id]"
          (ionChange)="responder($event.detail.value)">
          <ion-item *ngFor="let opcion of preguntas[preguntaActual].opciones; let i = index">
            <ion-label>{{ opcion }}</ion-label>
            <ion-radio slot="start" [value]="i"></ion-radio>
          </ion-item>
        </ion-radio-group>
      </ion-list>

      <ion-progress-bar [value]="(preguntaActual + 1) / preguntas.length"></ion-progress-bar>

      <ion-button expand="block" color="primary" (click)="siguiente()">
        {{ preguntaActual === preguntas.length - 1 ? 'Finalizar' : 'Siguiente' }}
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- Resultado -->
  <ion-card *ngIf="terminado && !cargando">
    <ion-card-header>
      <ion-card-title>Resultado Final</ion-card-title>
    </ion-card-header>
    <ion-card-content class="ion-text-center">
      <h2>{{ puntaje | number:'1.0-0' }}%</h2>
      <p *ngIf="puntaje >= 60" class="aprobado">✅ ¡Aprobaste!</p>
      <p *ngIf="puntaje < 60" class="reprobado">❌ No aprobaste, inténtalo de nuevo.</p>

      <ion-button expand="block" color="success" (click)="reiniciar()">Reintentar</ion-button>
      <ion-button expand="block" color="medium" routerLink="/inicio">Volver al inicio</ion-button>
    </ion-card-content>
  </ion-card>

</ion-content>
